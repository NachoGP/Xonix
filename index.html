<html>

<head>
    <title>HTML5 XoniX</title>
    
    <link rel="stylesheet" type="text/css" href="style/reset.min.css">
    <link rel="stylesheet" type="text/css" href="style/style.css">
    
    <script type="text/javascript" src="scripts/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="scripts/event_handler.js"></script>
    <script type="text/javascript" src="scripts/movable.js"></script>
    <script type="text/javascript" src="scripts/point.js"></script>
    <script type="text/javascript" src="scripts/edge.js"></script>
    <script type="text/javascript" src="scripts/path.js"></script>
    <script type="text/javascript" src="scripts/vector.js"></script>
    <script type="text/javascript" src="scripts/slice.js"></script>
    <script type="text/javascript" src="scripts/circle.js"></script>
    <script type="text/javascript" src="scripts/rectangle.js"></script>
    <script type="text/javascript" src="scripts/polygon.js"></script>
    <script type="text/javascript" src="scripts/ball.js"></script>
    <script type="text/javascript" src="scripts/monster.js"></script>
    <script type="text/javascript" src="scripts/player.js"></script>
    <script type="text/javascript" src="scripts/level.js"></script>
    <script type="text/javascript" src="scripts/game.js"></script>
    
    <script>
        var canvasWidth = 550,
            canvasHeight = 360,
            frameBorder = 18,
            numOfBalls = 10,
            numOfMonsters = 1,
            ballSize = 8,
            monsterSize = 9,
            speed = 4;
        var player,
            numOfLives = 3,
            playerSize = 9,
            trackSize = 9;
        var game;
        
        function random(min, max) {
            var val = min + Math.random() * (max - min);
            return Math.round(val);
        }
        
        function updateScore(value) {
            $('#score').html(value);
        }
        function updateLives(value) {
            $('#lives').html(value);
        }
        function updateConquered(value) {
            $('#conqured').html(value);
        }
        function updateTimer(value) {
            $('#timer').html(value);
        }
        
        $(document).ready(function() {
            var canvas = document.getElementById("canvas");  
            var ctx = canvas.getContext("2d");
            
            var game = new Game(canvasWidth, canvasHeight, frameBorder, numOfLives, playerSize, numOfBalls, numOfMonsters, ballSize, monsterSize, speed);
            game.addEventListener('conquer', updateConquered, this);
            game.addEventListener('fail', updateLives, this);
            game.addEventListener('score', updateScore, this);
            
            $(document).keydown(function(event) {
                switch (event.keyCode) {
                    case 37:
                        game.get_player().moveLeft();
                        break;
                    case 38:
                        game.get_player().moveUp();
                        break;
                    case 39:
                        game.get_player().moveRight();
                        break;
                    case 40:
                        game.get_player().moveDown();
                        break;
            }});
            
            //create DEBUG track
            var trackPoly = new Polygon([
                new Point(200 - (trackSize/2), frameBorder),
                new Point(200 + (trackSize/2), frameBorder),
                new Point(200 + (trackSize/2), 100 - (trackSize/2)),
                new Point(300 + (trackSize/2), 100 - (trackSize/2)),
                new Point(300 + (trackSize/2), 200 + (trackSize/2)),
                new Point(260 + (trackSize/2), 200 + (trackSize/2)),
                new Point(260 + (trackSize/2), canvasHeight - frameBorder),
                new Point(260 - (trackSize/2), canvasHeight - frameBorder),
                new Point(260 - (trackSize/2), 200 - (trackSize/2)),
                new Point(300 - (trackSize/2), 200 - (trackSize/2)),
                new Point(300 - (trackSize/2), 100 + (trackSize/2)),
                new Point(200 - (trackSize/2), 100 + (trackSize/2))
            ]);
            var innerPath = new Path([
                new Point(200 - (trackSize/2), frameBorder),
                new Point(200 - (trackSize/2), 100 + (trackSize/2)),
                new Point(300 - (trackSize/2), 100 + (trackSize/2)),
                new Point(300 - (trackSize/2), 200 - (trackSize/2)),
                new Point(260 - (trackSize/2), 200 - (trackSize/2)),
                new Point(260 - (trackSize/2), canvasHeight - frameBorder)
            ]);
            var outerPath = new Path([
                new Point(200 + (trackSize/2), frameBorder),
                new Point(200 + (trackSize/2), 100 - (trackSize/2)),
                new Point(300 + (trackSize/2), 100 - (trackSize/2)),
                new Point(300 + (trackSize/2), 200 + (trackSize/2)),
                new Point(260 + (trackSize/2), 200 + (trackSize/2)),
                new Point(260 + (trackSize/2), canvasHeight - frameBorder)
            ]);
            game.conquer(trackPoly, innerPath, outerPath);
            
            function step() {
                game.step();
            }
            
            function draw() {
                game.draw(ctx);
            }
            
            setInterval(function () {
                ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                step();
                draw();
            }, 1000 / 50);
        });
    </script>
</head>

<body>
    <div id="container">
        <canvas id="canvas" width="550" height="360"></canvas>
        <div id="status">
            Score: <span id="score">0</span>    Xn: <span id="lives">3</span>   Full: <span id="conqured">0</span>%    Time: <span id="timer">90</span>
        </div>
    </div>
</body>

</html>